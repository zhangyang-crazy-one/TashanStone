# 待办事项

> 最后更新：2025-12-28

## 上下文工程任务概览

| 优先级 | 任务 | 工作量 | 状态 |
|--------|------|--------|------|
| 高 | 阶段一：核心上下文工程 | 5-7 天 | ✅ 完成 |
| 高 | 阶段二：会话存储与检查点 | 3-4 天 | 🔄 进行中 |
| 中 | 阶段三：三层记忆系统 | 4-5 天 | 🔜 待开始 |
| 中 | 阶段四：UI 集成 | 3-4 天 | 🔜 待开始 |
| 低 | 阶段五：性能优化 | 2-3 天 | 🔜 待开始 |

### 阶段一详细任务 ✅

| 子任务 | 描述 | 状态 |
|--------|------|------|
| [x] 1.1 类型定义 | 扩展 ApiMessage、定义 TokenUsage、ContextConfig 等接口 | ✅ 完成 |
| [x] 1.2 上下文管理器 | 实现 ContextManager 类，Token 计算、使用率分析、触发决策 | ✅ 完成 |
| [x] 1.3 Prune 算法 | 实现工具输出裁剪，保护最近对话 | ✅ 完成 |
| [x] 1.4 Compact 算法 | 实现 LLM 摘要生成，非破坏性标记 | ✅ 完成 |
| [x] 1.5 Truncate 算法 | 实现滑动窗口截断 | ✅ 完成 |
| [x] 1.6 Token 预算管理 | 实现动态预算分配、阈值检查 | ✅ 完成 |

### 阶段二详细任务

| 子任务 | 描述 | 状态 |
|--------|------|------|
| [ ] 2.1 数据库迁移 | 设计并执行消息表扩展、检查点表创建 | 待开始 |
| [ ] 2.2 存储接口扩展 | 扩展 chatRepository 支持压缩标记 | 待开始 |
| [ ] 2.3 检查点管理器 | 实现检查点创建、恢复、列表功能 | 待开始 |

## 中优先级

| 任务 | 描述 | 预计工作量 | 状态 |
|------|------|-----------|------|
| [ ] 阶段三：三层记忆系统 | 短期/中期/长期记忆，RAG 集成 | 4-5 天 | 待开始 |
| [ ] 阶段四：UI 集成 | Token 显示、压缩按钮、检查点面板 | 3-4 天 | 待开始 |
| [ ] 优化知识图谱 | 大文件渲染性能优化 | 2-3 天 | 待开始 |
| [ ] 移动端适配 | 响应式布局优化 | 1 周 | 待开始 |

### 阶段三详细任务

| 子任务 | 描述 | 状态 |
|--------|------|------|
| [ ] 3.1 短期记忆 | 内存中对话上下文管理 | 待开始 |
| [ ] 3.2 中期记忆 | SQLite 摘要存储 | 待开始 |
| [ ] 3.3 长期记忆 | 扩展 RAG 支持对话索引 | 待开始 |

### 阶段四详细任务

| 子任务 | 描述 | 状态 |
|--------|------|------|
| [ ] 4.1 TokenUsageIndicator | Token 使用率显示组件 | 待开始 |
| [ ] 4.2 ContextActionBadge | 上下文操作状态指示 | 待开始 |
| [ ] 4.3 CompactButton | 手动压缩按钮 | 待开始 |
| [ ] 4.4 CheckpointDrawer | 检查点历史面板 | 待开始 |
| [ ] 4.5 AI 设置扩展 | 添加上下文工程配置区 | 待开始 |

## 低优先级

| 任务 | 描述 | 预计工作量 | 状态 |
|------|------|-----------|------|
| [ ] 阶段五：性能优化 | Prompt Caching、流式优化 | 2-3 天 | 待开始 |
| [ ] 主题扩展 | 添加新主题 | 1-2 天 | 待开始 |
| [ ] 快捷键优化 | 自定义快捷键 | 2-3 天 | 待开始 |

## 相关文档

- 项目概览：[PROJECT.md](./PROJECT.md)
- 项目状态：[PROJECT_STATUS.md](./PROJECT_STATUS.md)
- 上下文工程实施计划：[CONTEXT_ENGINEERING.md](./CONTEXT_ENGINEERING.md)
