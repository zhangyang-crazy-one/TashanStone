# å¾…åŠäº‹é¡¹

> æœ€åæ›´æ–°ï¼š2026-01-12
> ç‰ˆæœ¬ï¼šV1.81 ä¸Šä¸‹æ–‡å·¥ç¨‹ä¼˜åŒ–
> **v1.81 ä¸Šä¸‹æ–‡å·¥ç¨‹ä¼˜åŒ–å·²å®Œæˆ âœ…**

---

## ğŸš€ v1.80 - æ™ºèƒ½é“¾æ¥æ’å…¥ç³»ç»Ÿ

> **å½“å‰è¿›åº¦**: 10% å¼€å§‹
> **è®¡åˆ’**: [plans/typed-munching-sphinx.md](../.claude/plans/typed-munching-sphinx.md)

### åŠŸèƒ½æ¦‚è¿°

| æ¨¡å¼ | å¿«æ·é”® | è¾“å‡ºæ ¼å¼ |
|------|--------|----------|
| WikiLink | `Ctrl+Alt+K` | `[[æ–‡ä»¶å]]` æˆ– `[[æ–‡ä»¶å\|åˆ«å]]` |
| å—å¼•ç”¨ | `Ctrl+Alt+Shift+K` | `((æ–‡ä»¶å#è¡Œå·-è¡Œå·))` |
| å¿«é€Ÿé“¾æ¥ | `Ctrl+Alt+L` | `[[æ–‡ä»¶å\|é€‰ä¸­æ–‡æœ¬]]` |

### ä»»åŠ¡æ¸…å•

| é¡ºåº | ä»»åŠ¡ | ä½ç½® | å·¥æ—¶ | çŠ¶æ€ |
|------|------|------|------|------|
| 1 | æ·»åŠ  CodeMirrorEditorRef æ¥å£ | `types.ts` | 30min | â³ å¾…å¼€å§‹ |
| 2 | æ·»åŠ  ActionId ç±»å‹ | `types.ts` | 15min | â³ å¾…å¼€å§‹ |
| 3 | æ·»åŠ  linkInsert ç¿»è¯‘ | `utils/translations.ts` | 30min | â³ å¾…å¼€å§‹ |
| 4 | æ·»åŠ  forwardRef + useImperativeHandle | `CodeMirrorEditor.tsx` | 1h | â³ å¾…å¼€å§‹ |
| 5 | æ·»åŠ  CodeMirror 6 keymap | `CodeMirrorEditor.tsx` | 1h | â³ å¾…å¼€å§‹ |
| 6 | åˆ›å»º LinkInsertModal ç»„ä»¶ | `components/LinkInsertModal.tsx` | 3h | â³ å¾…å¼€å§‹ |
| 7 | é›†æˆé“¾æ¥æ’å…¥åŠŸèƒ½ | `App.tsx` | 2h | â³ å¾…å¼€å§‹ |
| 8 | æµ‹è¯•éªŒè¯ | å…¨é¡¹ç›® | 1h | â³ å¾…å¼€å§‹ |

### é¢„è®¡å·¥æ—¶: 9.5h

---

## ğŸ”§ v1.81 - ä¸Šä¸‹æ–‡å·¥ç¨‹ä¼˜åŒ–

> **å½“å‰è¿›åº¦**: 100% å®Œæˆ âœ…
> **éªŒè¯æ—¥æœŸ**: 2026-01-12

### âœ… å·²å®Œæˆä¿®å¤

| ä»»åŠ¡ | ä½ç½® | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|------|
| å·¥å…·å¡ç‰‡æ–‡å­—æº¢å‡º | `ToolCallCard.tsx:399` | âœ… å·²å®Œæˆ | æ·»åŠ  `flex-1 min-w-0` |
| å·¥å…·å¡ç‰‡ JSON è§£æ | `ToolCallCard.tsx:622-668` | âœ… å·²å®Œæˆ | æ·»åŠ  `laxToolPattern` æ­£åˆ™ |
| è®°å¿†ä¿å­˜ç›®å½• | `fileHandlers.ts:120-138` | âœ… å·²å®Œæˆ | è‡ªåŠ¨åˆ›å»ºçˆ¶ç›®å½• |
| è®°å¿†ç›®å½• explicit | `persistent-memory.ts:47-72` | âœ… å·²å®Œæˆ | æ·»åŠ  `ensureDir` è°ƒç”¨ |
| CodeMirror RAF è­¦å‘Š | `CodeMirrorEditor.tsx:245-586` | âœ… å·²å®Œæˆ | æ·»åŠ  `mountedRef` ä¿æŠ¤ |

### æ–°å¢åŠŸèƒ½

| åŠŸèƒ½ | æ–‡ä»¶ | è¯´æ˜ |
|------|------|------|
| è£¸ JSON è§£æ | `ToolCallCard.tsx` | æ”¯æŒ `json\n[...]` å’Œ `json\n{...}` æ ¼å¼ |
| ç›®å½•è‡ªåŠ¨åˆ›å»º | `fileHandlers.ts`, `persistent-memory.ts` | è‡ªåŠ¨åˆ›å»º `.memories` ç›®å½• |
| ç»„ä»¶ç”Ÿå‘½å‘¨æœŸä¿æŠ¤ | `CodeMirrorEditor.tsx` | é˜²æ­¢å¸è½½å RAF å›è°ƒæ‰§è¡Œ |

### å¾…æ”¹è¿›

| ä¼˜å…ˆçº§ | ä»»åŠ¡ | è¯´æ˜ |
|--------|------|------|
| ğŸŸ¡ | åŠ¨æ€å·¥å…·é€‰æ‹© | æ ¹æ®å¯¹è¯å†…å®¹é€‰æ‹©å·¥å…·å­é›†ï¼Œå‡å°‘ Token æ¶ˆè€— |
| ğŸŸ¢ | Compact å‡½æ•°ç»Ÿä¸€ | åˆå¹¶é‡å¤çš„ compact å‡½æ•°ï¼Œå‡å°‘ä»£ç é‡å¤ |
| ğŸŸ¢ | è®°å¿†å‹ç¼©ç­–ç•¥ | å®ç°æ›´æ™ºèƒ½çš„è®°å¿†å‹ç¼©ç®—æ³• |

---

## âœ… v1.78 - æ€§èƒ½ä¼˜åŒ–ä¸å®‰å…¨åŠ å›º

> **å½“å‰è¿›åº¦**: 100% å®Œæˆ âœ…
> **éªŒè¯æ—¥æœŸ**: 2026-01-02

### âœ… å·²å®Œæˆä¼˜åŒ–

| ä»»åŠ¡ | ä½ç½® | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|------|
| è™šæ‹Ÿæ»šåŠ¨ | `ChatPanel.tsx` | âœ… å·²å®Œæˆ | ä½¿ç”¨ react-window + react-virtualized-auto-sizer |
| æ€§èƒ½ä¼˜åŒ– | `ChatPanel.tsx` | âœ… å·²å®Œæˆ | ä½¿ç”¨ useCallback, memo, MESSAGE_ITEM_HEIGHT å¸¸é‡ |
| å¯è®¿é—®æ€§ | `ChatPanel.tsx` | âœ… å·²å®Œæˆ | æ·»åŠ  aria-posinset, aria-setsize, role="listitem" |
| TypeScript ç¼–è¯‘ | å…¨é¡¹ç›® | âœ… å·²å®Œæˆ | 0 errors |
| æµ‹è¯•é€šè¿‡ | å…¨é¡¹ç›® | âœ… å·²å®Œæˆ | 112/112 tests passing |

### âœ… P0 å®‰å…¨ä¿®å¤ (å·²å®Œæˆ)

| é¡ºåº | ä»»åŠ¡ | ä½ç½® | å·¥æ—¶ | è¯´æ˜ |
|------|------|------|------|------|
| 1 | æ–‡ä»¶è·¯å¾„éªŒè¯ | `electron/ipc/fileHandlers.ts` | - | âœ… å·²å­˜åœ¨ validateFilePath å‡½æ•° (V1.81 å¢å¼º) |
| 2 | å¯†ç é‡ç½®éªŒè¯ | `electron/ipc/dbHandlers.ts` | - | âœ… å·²æ·»åŠ å½“å‰å¯†ç éªŒè¯ |

### âœ… P1 UX æ”¹è¿› (å·²å®Œæˆ)

| é¡ºåº | ä»»åŠ¡ | ä½ç½® | å·¥æ—¶ | è¯´æ˜ |
|------|------|------|------|------|
| 3 | åˆ é™¤ç¡®è®¤å¯¹è¯æ¡† | `Sidebar.tsx` | âœ… å®Œæˆ | å³é”®èœå•åˆ é™¤ä¹Ÿä½¿ç”¨ç¡®è®¤å¯¹è¯æ¡† |
| 4 | åŠ è½½çŠ¶æ€æŒ‡ç¤ºå™¨ | å¤šä¸ªç»„ä»¶ | âœ… å®Œæˆ | Toolbar (AIæ€è€ƒ) + Sidebar (OCR/RAG) |

### âœ… P2 å¯è®¿é—®æ€§å¢å¼º (å·²å®Œæˆ)

| é¡ºåº | ä»»åŠ¡ | ä½ç½® | å·¥æ—¶ | è¯´æ˜ |
|------|------|------|------|------|
| 5 | aria-label è¡¥å…… | `Toolbar.tsx` | â³ å¾…å®Œæˆ | éƒ¨åˆ†æŒ‰é’®ç¼ºå°‘ aria-label |
| 6 | é”®ç›˜å¯¼èˆªå¢å¼º | `KnowledgeGraph.tsx` | âœ… å®Œæˆ | ç®­å¤´é”®å¯¼èˆª/Enteré€‰æ‹©/Escå–æ¶ˆ/+/-ç¼©æ”¾/0é‡ç½® |

---

## âœ… v1.78 - æ€§èƒ½ä¼˜åŒ–ä¸å®‰å…¨åŠ å›º (å·²å®Œæˆ)

> **å½“å‰è¿›åº¦**: 100% å®Œæˆ âœ…
> **éªŒè¯æ—¥æœŸ**: 2026-01-02

### æ€§èƒ½ä¼˜åŒ–

| ä»»åŠ¡ | ä½ç½® | è¯´æ˜ |
|------|------|------|
| çŸ¥è¯†å›¾è°±ç´¢å¼•ç¼“å­˜ | `wikiLinkService.ts` | æ·»åŠ  FILE_CONTENT_CACHE å’Œ INDEX_CACHEï¼Œ30ç§’TTLç¼“å­˜ |
| æœç´¢å†…å®¹ç´¢å¼•ç¼“å­˜ | `searchService.ts` | æ·»åŠ  _contentIndex ç¼“å­˜ï¼Œé¿å…é‡å¤ toLowerCase() |
| é¢˜åº“æ‰¹é‡ç»Ÿè®¡ç¼“å­˜ | `questionBankService.ts` | æ·»åŠ  getAllBanksStats() æ–¹æ³•ï¼Œ10ç§’TTLæ‰¹é‡ç¼“å­˜ |

### æ€§èƒ½æå‡

| ä¼˜åŒ–é¡¹ | æ”¹è¿›å‰ | æ”¹è¿›å |
|--------|--------|--------|
| WikiLink æå– | æ¯æ¬¡éƒ½è§£æ content | ç¼“å­˜ 30 ç§’ |
| å†…å®¹æœç´¢ | æ¯æ¬¡éƒ½ toLowerCase() | é¢„ç¼“å­˜å°å†™å†…å®¹ |
| é¢˜åº“ç»Ÿè®¡ | æ¯æ¬¡éƒ½éå†æ‰€æœ‰é¢˜ç›® | æ‰¹é‡ç¼“å­˜ 10 ç§’ |
| é“¾æ¥å›¾ç”Ÿæˆ | æ•°ç»„ find O(n) | Map æŸ¥æ‰¾ O(1) |

### æµ‹è¯•ç»“æœ

| æŒ‡æ ‡ | å€¼ |
|------|-----|
| æµ‹è¯•ç”¨ä¾‹ | 112 passed |
| TypeScript ç¼–è¯‘ | 0 errors |
| é€šè¿‡ç‡ | 100% |

---

## âœ… v1.77 - Snippets ä¿®å¤ä¸å¢å¼º (å·²å®Œæˆ)

> **å½“å‰è¿›åº¦**: 100% å®Œæˆ âœ…
> **è®¡åˆ’æ–‡æ¡£**: [docs/issues/SNIPPETS_FIX_PLAN.md](./issues/SNIPPETS_FIX_PLAN.md)

### é—®é¢˜æ¦‚è¿°

| é—®é¢˜ | å½±å“ | ä¸¥é‡æ€§ |
|------|------|--------|
| CodeMirror å†…å®¹åŒæ­¥å¤±æ•ˆ | æ’å…¥åå†…å®¹ä¸æ›´æ–° | ğŸ”´ é«˜ |
| å…‰æ ‡ä½ç½®å¤„ç†é”™è¯¯ | æ’å…¥åå…‰æ ‡è·³åˆ°é”™è¯¯ä½ç½® | ğŸ”´ é«˜ |
| ç”¨æˆ·è‡ªå®šä¹‰ Snippets ä¸æ˜¾ç¤º | åªèƒ½ä½¿ç”¨é»˜è®¤æ¨¡æ¿ | ğŸŸ  ä¸­ |
| åªèƒ½åœ¨æ–‡ä»¶æœ«å°¾æ’å…¥ | æ— æ³•åœ¨å…‰æ ‡å¤„æ’å…¥ | ğŸŸ  ä¸­ |
| ç¼ºå°‘ WikiLink æ¨¡æ¿ | ç”¨æˆ·æ— æ³•å¿«é€Ÿæ’å…¥åŒå‘é“¾æ¥ | ğŸŸ¢ ä½ |

### ä¿®å¤å®Œæˆ

| é¡ºåº | ä»»åŠ¡ | ä½ç½® | å·¥æ—¶ | çŠ¶æ€ |
|------|------|------|------|------|
| 1 | CodeMirror å†…å®¹åŒæ­¥ | `CodeMirrorEditor.tsx` | 1h | âœ… å®Œæˆ |
| 2 | å…‰æ ‡ä½ç½®å¤„ç† | `App.tsx` | 2h | âœ… å®Œæˆ |
| 3 | æ˜¾ç¤ºç”¨æˆ·è‡ªå®šä¹‰ Snippets | `Sidebar.tsx` | 1h | âœ… å®Œæˆ |
| 4 | æ–°å¢ WikiLink æ¨¡æ¿ | `Sidebar.tsx` | 1h | âœ… å®Œæˆ |
| 5 | æ·»åŠ å›½é™…åŒ–æ–‡æœ¬ | `utils/translations.ts` | 30min | âœ… å®Œæˆ |

### æ–°å¢ WikiLink æ¨¡æ¿

| æ¨¡æ¿ ID | åç§° | å†…å®¹ |
|---------|------|------|
| `wikilink-plain` | File Link | `[[{filename}]]` |
| `wikilink-alias` | Link with Alias | `[[{filename}\|{alias}]]` |
| `wikilink-block` | Block Reference | `<<{filename}:{line}>>` |

**æµ‹è¯•ç»“æœ**: 112/112 é€šè¿‡ âœ…

---

## ğŸ”§ v1.76 - æ€§èƒ½ä¸å®‰å…¨ä¼˜åŒ–

> åŸºäº V1.75 ä»£ç å®¡æŸ¥å‘ç°çš„ä¼˜åŒ–æœºä¼š
> **å½“å‰è¿›åº¦**: 100% - Bug ä¿®å¤å®Œæˆ âœ…

### Bug ä¿®å¤

| é—®é¢˜ | ä½ç½® | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|------|
| Preview.tsx visit ç©ºæŒ‡é’ˆå¼‚å¸¸ | `Preview.tsx:67` | âœ… å·²ä¿®å¤ | æ·»åŠ  try-catch å’Œç©ºå€¼æ£€æŸ¥ |
| WikiLinkPreview æ‚¬æµ®é¢„è§ˆç¼ºå¤± | `Preview.tsx:220` | âœ… å·²ä¿®å¤ | æ·»åŠ  files å±æ€§å’Œé¢„è§ˆåŠŸèƒ½ |
| WikiLink files æ•°ç»„ä¼ é€’é”™è¯¯ | `Editor.tsx:53` | âœ… å·²ä¿®å¤ | ä¼ é€’å®Œæ•´ files æ•°ç»„ |
| WikiLink æ–‡ä»¶åŒ¹é…é€»è¾‘ç»Ÿä¸€ | `wikiLinkService.ts` | âœ… å·²å®Œæˆ | findFileByWikiLinkTarget å‡½æ•° |
| suggestTags API 404 é”™è¯¯ | `services/aiService.ts:3748` | âœ… å·²ä¿®å¤ | ä¿®æ­£ç«¯ç‚¹è·¯å¾„å’Œæ”¯æŒ MiniMaxi æ ¼å¼ |
| AI è¯­è¨€è®¾ç½®ä¸ç”Ÿæ•ˆ | `services/aiService.ts:4065` | âœ… å·²ä¿®å¤ | æ·»åŠ ä¸­è‹±æ–‡ prompts æ”¯æŒ |
| UI æ–‡æœ¬æœªåº”ç”¨ i18n ç¿»è¯‘ | å¤šä¸ªç»„ä»¶ | âœ… å·²ä¿®å¤ | æ·»åŠ æ ‡ç­¾å»ºè®®ã€é¢˜åº“ã€å¤ä¹ ç­‰é¡µé¢ç¿»è¯‘ |
| **CodeMirror æ— æ³•æ»šåŠ¨** | `CodeMirrorEditor.tsx:260` | âœ… å·²ä¿®å¤ | ç§»é™¤ `overflow-hidden`ï¼Œæ·»åŠ  `overflow-y-auto` |
| **CodeMirror æ— æ³•ç¼–è¾‘** | `CodeMirrorEditor.tsx:268` | âœ… å·²ä¿®å¤ | æ·»åŠ  `editable={true}` å’Œ `readOnly={false}` |
| **CodeMirror å…‰æ ‡ä¸è¿½è¸ª** | `CodeMirrorEditor.tsx:247` | âœ… å·²ä¿®å¤ | ä¼˜åŒ–åˆå§‹åŒ–é€»è¾‘ |
| **åˆ‡æ¢ç¼–è¾‘å™¨æ—¶å…‰æ ‡ä¸¢å¤±** | `App.tsx:791` | âœ… å·²ä¿®å¤ | æ·»åŠ  handleToggleCodeMirror åŒ…è£…å‡½æ•° |
| **åˆ‡æ¢åå…‰æ ‡è·³è‡³åˆå§‹ä½ç½®** | `App.tsx:791` | âœ… å·²ä¿®å¤ | ä»å¤šä¸ªæ¥æºè·å–å…‰æ ‡ä½ç½® |
| **åˆ‡æ¢ç¼–è¾‘å™¨æ—¶å…‰æ ‡ä¸æ¢å¤** | `Editor.tsx:83` | âœ… å·²ä¿®å¤ | æ£€æŸ¥å…‰æ ‡ä½ç½®æ˜¯å¦éœ€è¦æ›´æ–° |

### ä¼˜åŒ–ä»»åŠ¡åˆ—è¡¨

| é¡ºåº | ä»»åŠ¡ | ä½ç½® | å·¥æ—¶ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
|------|------|------|------|--------|------|
| 1 | XSS é¢„é˜² | `WikiLink.tsx:106` | 1h | ğŸ”´ é«˜ | âœ… å·²å®Œæˆ (escapeHtml) |
| 2 | çŸ¥è¯†å›¾è°±ç´¢å¼•æ€§èƒ½ | `wikiLinkService.ts:140` | 2-3h | ğŸŸ  ä¸­ | â³ å¾…å¼€å§‹ |
| 3 | æœç´¢æ€§èƒ½ä¼˜åŒ– | `searchService.ts:99` | 3-4h | ğŸŸ  ä¸­ | â³ å¾…å¼€å§‹ |
| 4 | é¢˜åº“ç»Ÿè®¡ç¼“å­˜ | `questionBankService.ts` | 1-2h | ğŸŸ¢ ä½ | â³ å¾…å¼€å§‹ |
| 5 | æ·»åŠ ç»„ä»¶æµ‹è¯• | `test/components/` | 4-6h | ğŸŸ¢ ä½ | â³ å¾…å¼€å§‹ |
| 6 | WikiLink åŒ¹é…é€»è¾‘ä¿®å¤ | `wikiLinkService.ts` | 30min | ğŸ”´ é«˜ | âœ… å·²å®Œæˆ |
| 7 | UI å›½é™…åŒ– (i18n) | å¤šä¸ªç»„ä»¶ | 2h | ğŸŸ  ä¸­ | âœ… å·²å®Œæˆ |
| 8 | CodeMirror ç¼–è¾‘å™¨ä¿®å¤ | `CodeMirrorEditor.tsx` | 1h | ğŸ”´ é«˜ | âœ… å·²å®Œæˆ |
| 9 | åˆ‡æ¢ç¼–è¾‘å™¨æ—¶ä¿å­˜å…‰æ ‡ | `App.tsx` | 30min | ğŸ”´ é«˜ | âœ… å·²å®Œæˆ |
| 10 | åˆ‡æ¢æ—¶æ¢å¤å…‰æ ‡ä½ç½® | `Editor.tsx` | 30min | ğŸ”´ é«˜ | âœ… å·²å®Œæˆ |

**æ€»è®¡å·¥æ—¶**: 13-20h
**è¯¦ç»†æŒ‡å—**: [V1.75_OPTIMIZATION_GUIDE.md](./V1.75_OPTIMIZATION_GUIDE.md)

---

## âœ… v1.75 - åŒå‘é“¾æ¥ä¸è¯•é¢˜åº“é›†æˆ (å·²å®Œæˆ)

> åŸºäº zhang_reader/New_Features/zhangnote é¡¹ç›®ç§»æ¤
> **å½“å‰è¿›åº¦**: 100% å®Œæˆ âœ…

> **å®ŒæˆçŠ¶æ€**: æ‰€æœ‰ Phase å·²å®Œæˆï¼Œ108 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼Œæ„å»ºéªŒè¯é€šè¿‡

---

### Phase 1: åŒå‘é“¾æ¥ç³»ç»Ÿ (8h) - 100% å®Œæˆ âœ…

| è¿›åº¦ | 17 ä»»åŠ¡ï¼Œå…¨éƒ¨å®Œæˆ |
|------|------------------|

#### 1.1 WikiLink ç±»å‹å®šä¹‰

**å‚è€ƒå®ç°**: `zhangnote/types.ts`, `zhangnote/services/knowledgeService.ts`

| ä»»åŠ¡ | æè¿° | çŠ¶æ€ | æ–‡ä»¶ |
|------|------|------|------|
| [x] 1.1.1 | å®šä¹‰ WikiLink, BlockReference, Backlink ç±»å‹ | âœ… å®Œæˆ | `src/types/wiki.ts` |
| [x] 1.1.2 | å®šä¹‰ KnowledgeIndex æ¥å£ | âœ… å®Œæˆ | `src/types/wiki.ts` |
| [x] 1.1.3 | å¯¼å‡ºç±»å‹å®šä¹‰ | âœ… å®Œæˆ | `src/types/index.ts` |

**æ ¸å¿ƒç±»å‹å®šä¹‰**:
```typescript
export interface WikiLink {
  target: string;
  alias?: string;
  position: { start: number; end: number };
}

export interface Backlink {
  sourceFileId: string;
  sourceFileName: string;
  linkType: 'wikilink' | 'blockref';
  context?: string;
}

export interface KnowledgeIndex {
  backlinks: Map<string, string[]>;  // targetName -> sourceFileIds
  tags: Map<string, string[]>;       // tagName -> fileIds
}
```

#### 1.2 é“¾æ¥æå–æœåŠ¡

**å‚è€ƒå®ç°**: `zhangnote/services/knowledgeService.ts:32-94`

| ä»»åŠ¡ | æè¿° | çŠ¶æ€ | æ–‡ä»¶ |
|------|------|------|------|
| [x] 1.2.1 | å®ç° extractWikiLinks() | âœ… å®Œæˆ | `src/services/wiki/wikiLinkService.ts` |
| [x] 1.2.2 | å®ç° extractBlockReferences() | âœ… å®Œæˆ | `src/services/wiki/wikiLinkService.ts` |
| [x] 1.2.3 | å®ç° extractTags() | âœ… å®Œæˆ | `src/services/wiki/wikiLinkService.
