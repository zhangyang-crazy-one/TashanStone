# 项目状态

> 最后更新：2025-12-28

## 当前状态

| 指标 | 值 |
|------|-----|
| 项目阶段 | 功能迭代中 |
| 整体进度 | 核心功能 100% / 上下文工程 5% |
| 代码行数 | ~20,000+ |
| 组件数量 | 20 个 React 组件 |

## 已完成模块

| 模块 | 状态 | 说明 |
|------|------|------|
| Markdown 编辑器 | ✅ | 完整编辑/预览功能 |
| AI 对话 | ✅ | Gemini/Ollama/OpenAI 兼容 |
| 知识图谱 | ✅ | D3.js 可视化 |
| 思维导图 | ✅ | Mermaid 渲染 |
| 测验系统 | ✅ | AI 生成测验题 |
| RAG 向量检索 | ✅ | LanceDB 集成 |
| MCP 工具协议 | ✅ | 完整协议支持 |
| 本地 OCR | ✅ | ONNX Runtime |
| 主题系统 | ✅ | 5 套主题 |
| 平台打包 | ✅ | Windows/Linux/macOS |

## 进行中模块 - 上下文工程

| 阶段 | 内容 | 进度 | 状态 |
|------|------|------|------|
| 阶段一 | 核心上下文工程 | 5% | 🔄 规划完成 |
| 阶段二 | 会话存储与检查点 | 0% | 🔜 待开始 |
| 阶段三 | 三层记忆系统 | 0% | 🔜 待开始 |
| 阶段四 | UI 集成 | 0% | 🔜 待开始 |
| 阶段五 | 性能优化 | 0% | 🔜 待开始 |

### 上下文工程完成项

- [x] 架构设计文档 (CONTEXT_ENGINEERING.md)
- [x] 类型定义规划
- [x] 文件结构规划
- [x] 核心算法设计 (Prune/Compact/Truncate)
- [x] 与现有服务整合策略
- [x] 测试策略规划

### 上下文工程目标

1. **智能上下文管理**：解决 AI 对话上下文窗口限制问题
2. **三层记忆架构**：短期/中期/长期记忆分层管理
3. **非破坏性压缩**：Prune/Compact/Truncate 算法
4. **检查点机制**：支持长任务恢复
5. **Token 预算管理**：动态分配和阈值触发

## 技术架构

```
┌────────────────────────────────────────────────┐
│                  React 19 前端                  │
│  ┌─────────┐ ┌─────────┐ ┌─────────────────┐  │
│  │ 编辑器  │ │ AI 对话 │ │ 知识图谱/思维导图 │  │
│  └────┬────┘ └────┬────┘ └────────┬────────┘  │
│       │          │               │            │
│  ┌────┴──────────┴───────────────┴────────┐   │
│  │           服务层 (Services)             │   │
│  │  ┌────────┐ ┌────────┐ ┌────────────┐  │   │
│  │  │   AI   │ │  RAG   │ │ Context(新)│  │   │
│  │  └────────┘ └────────┘ └────────────┘  │   │
│  │       │          │            │        │   │
│  │       ▼          ▼            ▼        │   │
│  │  ┌──────────────────────────────────┐  │   │
│  │  │     短期/中期/长期 记忆层         │  │   │
│  │  └──────────────────────────────────┘  │   │
│  └────────────────────────────────────────┘   │
└────────────────────────────────────────────────┘
                       │
┌──────────────────────┴─────────────────────────┐
│                 Electron 33 主进程              │
│  ┌─────────┐ ┌─────────┐ ┌─────────────────┐  │
│  │ SQLite  │ │ LanceDB │ │    MCP Client   │  │
│  │  (消息) │ │  (RAG)  │ │                 │  │
│  └─────────┘ └─────────┘ └─────────────────┘  │
└────────────────────────────────────────────────┘
```

## 下一步计划

### 立即开始：阶段一核心上下文工程

| 步骤 | 任务 | 说明 |
|------|------|------|
| 1 | 创建目录结构 | `src/services/context/` |
| 2 | 实现类型定义 | `types.ts` |
| 3 | 实现 Token 预算 | `token-budget.ts` |
| 4 | 实现上下文管理器 | `manager.ts` |
| 5 | 实现压缩算法 | `compaction.ts` |
| 6 | 单元测试 | Vitest 测试用例 |

### 文件结构

```
src/services/context/
├── index.ts              # 导出入口
├── manager.ts            # 上下文管理器
├── compaction.ts         # 压缩算法
├── memory.ts             # 记忆层
├── token-budget.ts       # Token 预算
├── checkpoint.ts         # 检查点
└── types.ts              # 类型定义
```

### 后续计划

1. **阶段二**：会话存储与检查点
    - 数据库迁移
    - 检查点机制

2. **阶段三**：三层记忆系统
    - 短期/中期/长期记忆实现

3. **阶段四**：UI 集成
    - Token 显示组件
    - 压缩按钮
    - 检查点面板

## 相关文档

- 项目概览：[PROJECT.md](./PROJECT.md)
- 待办事项：[TODO.md](./TODO.md)
- 上下文工程实施计划：[CONTEXT_ENGINEERING.md](./CONTEXT_ENGINEERING.md)
- 问题记录：[issues/](./issues/)
